- **System Scope**: F1 Race Analytics & Position Prediction stack combining FastF1 semi-live ingestion, relational storage for structured motorsport data, MongoDB-backed telemetry warehousing, ensemble ML models for finishing order inference, and a Streamlit-driven dashboard/API layer.
- **Key Entity – Drivers**: SQL table `drivers` (INT `driver_id` PK, INT `driver_number`, TEXT `abbreviation`, TEXT `full_name`, TEXT `team_name`, INT `year`, UNIQUE(driver_number, year)) captures season-specific driver identities consumed by results, predictions, and UI layers.
- **Key Entity – Teams**: SQL table `teams` (INT `team_id` PK, TEXT `team_name`, INT `year`, UNIQUE(team_name, year)) anchors constructor metadata referenced by drivers and analytics aggregations.
- **Key Entity – Races**: SQL table `races` (INT `race_id` PK, INT `year`, INT `round_number`, TEXT `event_name`, TEXT `country`, TEXT `location`, TEXT `event_date`, UNIQUE(year, round_number)) models the calendar and links all session, result, and prediction records.
- **Key Entity – Sessions**: SQL table `sessions` (INT `session_id` PK, INT `race_id` FK, TEXT `session_type`, TEXT `session_date`, TEXT `weather_conditions`, REAL `track_temp`, REAL `air_temp`, UNIQUE(race_id, session_type)) tracks processed session metadata for ingestion lineage and cached status.
- **Key Entity – Results**: SQL tables `qualifying_results`, `sprint_results`, and `race_results` share schema patterns (INT PK, INT `race_id` FK, INT `driver_number`, INT `position`, timing/points/status fields) to persist competitive outcomes per session type.
- **Key Entity – Laps & Strategy**: SQL tables `aggregated_laps` (lap-level timing, tyre, and flag states) and `tyre_stats` (stint aggregates) enable strategy analytics and feed feature engineering.
- **Key Entity – Predictions**: SQL table `predictions` (INT PK, INT `race_id` FK, TEXT `session_type`, INT `driver_number`, INT `predicted_position`, REAL `predicted_time`, REAL `confidence`, REAL `top10_probability`, TEXT `model_type`, TEXT `prediction_date`, JSON blobs) stores ensemble outputs with feature snapshots and SHAP payloads for explainability.
- **Key Entity – Telemetry**: MongoDB collections (mirroring `TelemetryHandler` JSON schema: metadata block + array of telemetry points with numeric channels such as Speed, Throttle, Brake, Distance, RPM) capture high-volume time series per driver/session for exploratory analytics.
- **Relationship – Drivers ↔ Teams**: `drivers.team_name` joins to `teams.team_name` on `year`, ensuring constructor assignments and enabling constructor-level aggregations in ML features and dashboards.
- **Relationship – Races ↔ Sessions/Results**: `sessions.race_id` and all result/prediction tables reference `races.race_id`, enforcing that every outcome and forecast is bound to a calendar event and enabling cascading deletes/updates at the race level.
- **Relationship – Predictions ↔ Drivers**: `predictions.driver_number` aligns with `drivers.driver_number` per season to contextualize forecasts with driver names, team colors, and telemetry cross-references.
- **Relationship – Laps ↔ Telemetry**: `aggregated_laps` rows provide lap indexes used as document keys into MongoDB telemetry collections, tying summarized lap metrics to raw channel traces for drill-down analysis.
- **SQL vs NoSQL Allocation**: Structured, slowly evolving domain entities (drivers, teams, races, sessions, results, strategy aggregates, predictions) reside in SQL for relational integrity, while high-cardinality time series and semi-structured telemetry JSON (per driver/session) live in MongoDB to optimize write throughput and flexible channel schemas.
- **Constraints & Types – Integrity**: Integer primary keys across SQL tables guarantee row identity; foreign keys on `race_id` and `driver_number` preserve referential integrity; TEXT fields store names/status; REAL columns hold timing/points; JSON columns retain model artifacts without schema bloat.
- **Constraints & Types – NoSQL**: Telemetry documents include ISO timestamps, numeric arrays, and derived statistical summaries; MongoDB schema validation enforces required metadata keys (`year`, `event`, `driver`, `session_type`) and caps document size per FIA session limits.
- **Process – Data Ingestion**: `F1DataFetcher` pulls FastF1 sessions, enables caching, and stages schedules, laps, and telemetry snapshots; `populate_database` extracts from cache to upsert SQL tables, ensuring idempotent updates per season.
- **Process – Feature Extraction**: `FeatureEngineer` builds tyre degradation, speed percentile, throttle/brake variance, cornering deltas, driver form, and driver×team×track interaction features sourced from SQL results and telemetry summaries.
- **Process – ML Pipeline**: `F1PredictionModel` and `AdvancedF1Predictor` scale features, train Gradient Boosting, Random Forest, LightGBM, XGBoost, CatBoost, and stacked rankers with time-aware splits, writing fitted artifacts plus metadata to disk.
- **Process – Prediction Serving**: Batch notebooks/notebooks/f1_2026_predictions.ipynb load trained models, score future races, persist predictions (including SHAP, confidence, probabilities) into SQL, and emit CSV exports for downstream consumers.
- **Process – Caching & Telemetry Management**: FastF1 cache directory preserves HTTP responses; telemetry handler writes MongoDB documents (or transitional JSON) organized per year/event/session to support offline analysis and low-latency retrieval.
- **Process – Backend & Dashboard**: `streamlit_app.py` orchestrates database reads, telemetry fetches, and model metadata to render multi-page dashboards (drivers, race predictions, telemetry charts) while enforcing read-only SQL access and optional custom queries.
